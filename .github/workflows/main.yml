name: Daily Stock List Update

# è¨­å®šè§¸ç™¼æ¢ä»¶ï¼š
# 1. schedule: æ”¹ç‚º 07:00 UTC (ç­‰æ–¼å°ç£æ™‚é–“ä¸‹åˆ 15:00)
#    é€™æ¨£å¯ä»¥ç›´æ¥æŠ“åˆ°ã€Œç•¶æ—¥ã€å‰›æ”¶ç›¤çš„ç±Œç¢¼æ•¸æ“šï¼Œä¸ç”¨ç­‰åˆ°éš”å¤©æ—©ä¸Šã€‚
# 2. workflow_dispatch: æ‰‹å‹•è§¸ç™¼æŒ‰éˆ•
on:
  schedule:
    - cron: '0 7 * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-stocks:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code (ä¸‹è¼‰ç¨‹å¼ç¢¼)
      uses: actions/checkout@v3

    - name: Set up Python (å®‰è£ Python)
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies (å®‰è£çˆ¬èŸ²å¥—ä»¶)
      run: |
        pip install requests pandas lxml html5lib

    - name: Run generator (åŸ·è¡Œçˆ¬èŸ²)
      run: python generator.py

    - name: Commit and Push if changed (æ›´æ–°è³‡æ–™åº«)
      run: |
        git config --global user.name 'GitHub Action Bot'
        git config --global user.email 'action@github.com'
        
        # ğŸ”¥ é—œéµä¿®æ”¹ï¼šåŒæ™‚åŠ å…¥å…©å€‹ JSON æª”æ¡ˆ
        git add stock_list.json daily_recommendations.json
        
        # æª¢æŸ¥æ˜¯å¦æœ‰è®Šå‹•ï¼Œæœ‰æ‰ commitï¼Œé¿å…å ±éŒ¯
        git diff --quiet && git diff --staged --quiet || (git commit -m "ğŸ¤– Auto-update stock list & recommendations" && git push)
