name: Daily Stock List Update

# è¨­å®šè§¸ç™¼æ¢ä»¶ï¼š
# 1. schedule: æ¯å¤©åœ‹éš›æ¨™æº–æ™‚é–“ 00:00 (å°ç£æ™‚é–“æ—©ä¸Š 08:00) åŸ·è¡Œ
# 2. workflow_dispatch: è®“ä½ å¯ä»¥æ‰‹å‹•æŒ‰æŒ‰éˆ•è§¸ç™¼ (æ–¹ä¾¿æ¸¬è©¦)
on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-stocks:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code (ä¸‹è¼‰ç¨‹å¼ç¢¼)
      uses: actions/checkout@v3

    - name: Set up Python (å®‰è£ Python)
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies (å®‰è£çˆ¬èŸ²å¥—ä»¶)
      run: |
        pip install requests pandas lxml html5lib

    - name: Run generator (åŸ·è¡Œçˆ¬èŸ²)
      run: python generator.py

    - name: Commit and Push if changed (å¦‚æœæœ‰æ›´æ–°å°±æ¨é€åˆ° GitHub)
      run: |
        git config --global user.name 'GitHub Action Bot'
        git config --global user.email 'action@github.com'
        git add stock_list.json
        # åªæœ‰ç•¶æª”æ¡ˆçœŸçš„æœ‰è®Šå‹•æ™‚æ‰ commitï¼Œä¸ç„¶æœƒå ±éŒ¯
        git diff --quiet && git diff --staged --quiet || (git commit -m "ğŸ¤– Auto-update stock list" && git push)
